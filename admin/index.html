<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="shortcut icon" href="../assets/images/favicon.svg" type="image/x-icon" />
        <title>Tables | PlainAdmin Demo</title>

        <!-- ========== All CSS files linkup ========= -->
        <link rel="stylesheet" href="../assets/css/bootstrap.min.css" />
        <link rel="stylesheet" href="../assets/css/lineicons.css" />
        <link rel="stylesheet" href="../assets/css/materialdesignicons.min.css" />
        <link rel="stylesheet" href="../assets/css/fullcalendar.css" />
        <link rel="stylesheet" href="../assets/css/main.css" />
    </head>

    <body>
        <!-- ======== Preloader =========== -->
        <div id="preloader">
            <div class="spinner"></div>
        </div>
        <!-- ======== Preloader =========== -->

        <!-- ======== sidebar-nav start =========== -->
        <aside class="sidebar-nav-wrapper">
            <!-- <div class="navbar-logo">
                <a href="index.html">
                    <img src="../assets/images/logo/logo.svg" alt="logo" />
                </a>
            </div> -->
            <nav class="sidebar-nav">
                <ul>
                    <li class="nav-item active">
                        <a href="index.html">
                            <span class="icon">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M1.66666 4.16667C1.66666 3.24619 2.41285 2.5 3.33332 2.5H16.6667C17.5872 2.5 18.3333 3.24619 18.3333 4.16667V9.16667C18.3333 10.0872 17.5872 10.8333 16.6667 10.8333H3.33332C2.41285 10.8333 1.66666 10.0872 1.66666 9.16667V4.16667Z" />
                                    <path
                                        d="M1.875 13.75C1.875 13.4048 2.15483 13.125 2.5 13.125H17.5C17.8452 13.125 18.125 13.4048 18.125 13.75C18.125 14.0952 17.8452 14.375 17.5 14.375H2.5C2.15483 14.375 1.875 14.0952 1.875 13.75Z" />
                                    <path
                                        d="M2.5 16.875C2.15483 16.875 1.875 17.1548 1.875 17.5C1.875 17.8452 2.15483 18.125 2.5 18.125H17.5C17.8452 18.125 18.125 17.8452 18.125 17.5C18.125 17.1548 17.8452 16.875 17.5 16.875H2.5Z" />
                                </svg>
                            </span>
                            <span class="text">Kamar</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="./tipe_kamar/tipe_kamar.html">
                            <span class="icon">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M1.66666 4.16667C1.66666 3.24619 2.41285 2.5 3.33332 2.5H16.6667C17.5872 2.5 18.3333 3.24619 18.3333 4.16667V9.16667C18.3333 10.0872 17.5872 10.8333 16.6667 10.8333H3.33332C2.41285 10.8333 1.66666 10.0872 1.66666 9.16667V4.16667Z" />
                                    <path
                                        d="M1.875 13.75C1.875 13.4048 2.15483 13.125 2.5 13.125H17.5C17.8452 13.125 18.125 13.4048 18.125 13.75C18.125 14.0952 17.8452 14.375 17.5 14.375H2.5C2.15483 14.375 1.875 14.0952 1.875 13.75Z" />
                                    <path
                                        d="M2.5 16.875C2.15483 16.875 1.875 17.1548 1.875 17.5C1.875 17.8452 2.15483 18.125 2.5 18.125H17.5C17.8452 18.125 18.125 17.8452 18.125 17.5C18.125 17.1548 17.8452 16.875 17.5 16.875H2.5Z" />
                                </svg>
                            </span>
                            <span class="text">Tipe kamar</span>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a href="profile/profile.html">
                            <span class="icon">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M1.66666 4.16667C1.66666 3.24619 2.41285 2.5 3.33332 2.5H16.6667C17.5872 2.5 18.3333 3.24619 18.3333 4.16667V9.16667C18.3333 10.0872 17.5872 10.8333 16.6667 10.8333H3.33332C2.41285 10.8333 1.66666 10.0872 1.66666 9.16667V4.16667Z" />
                                    <path
                                        d="M1.875 13.75C1.875 13.4048 2.15483 13.125 2.5 13.125H17.5C17.8452 13.125 18.125 13.4048 18.125 13.75C18.125 14.0952 17.8452 14.375 17.5 14.375H2.5C2.15483 14.375 1.875 14.0952 1.875 13.75Z" />
                                    <path
                                        d="M2.5 16.875C2.15483 16.875 1.875 17.1548 1.875 17.5C1.875 17.8452 2.15483 18.125 2.5 18.125H17.5C17.8452 18.125 18.125 17.8452 18.125 17.5C18.125 17.1548 17.8452 16.875 17.5 16.875H2.5Z" />
                                </svg>
                            </span>
                            <span class="text">Profile</span>
                        </a>
                    </li>
                    <span class="divider">
                        <hr />
                    </span>


                </ul>
            </nav>

        </aside>
        <div class="overlay"></div>
        <!-- ======== sidebar-nav end =========== -->

        <!-- ======== main-wrapper start =========== -->
        <main class="main-wrapper">
            <!-- ========== header start ========== -->
            <header class="header">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-5 col-md-5 col-6">
                            <div class="header-left d-flex align-items-center">

                                <div class="header-search d-none d-md-flex">
                                    <form onsubmit="event.preventDefault(); getKamarByNomorKamar();">
                                        <input type="text" placeholder="Search..." />
                                        <button type="submit">
                                            <i class="lni lni-search-alt"></i>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>
            <!-- ========== header end ========== -->

            <!-- ========== table components start ========== -->
            <section class="table-components">
                <div class="container-fluid">
                    <!-- ========== title-wrapper start ========== -->
                    <div class="title-wrapper pt-30">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div class="title">
                                    <h2>Data kamar</h2>

                                </div>
                            </div>
                            <!-- end col -->
                            <div class="col-md-6">
                                <div class="breadcrumb-wrapper">
                                    <a href="kamar/add-kamar.html" class="main-btn primary-btn-light rounded-full btn-hover">Tambah
                                        Kamar</a>
                                </div>
                            </div>
                            <!-- end col -->

                        </div>
                        <!-- end row -->
                    </div>
                    <!-- ========== title-wrapper end ========== -->
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card-style mb-30">
                                <!-- <h6 class="mb-10">Data Table</h6>
                                    <p class="text-sm mb-20">
                                        For basic styling—light padding and only
                                        horizontal dividers—use the class table.
                                    </p> -->
                                <div class="table-wrapper table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>
                                                    <h6>Nomor kamar</h6>
                                                </th>
                                                <th>
                                                    <h6>Tipe kamar</h6>
                                                </th>
                                                <th>
                                                    <h6>Status</h6>
                                                </th>
                                                <th>
                                                    <h6>Action</h6>
                                                </th>

                                            </tr>
                                            <!-- end table row-->
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                    <!-- end table -->
                                </div>
                            </div>
                            <!-- end card -->
                        </div>
                        <!-- end col -->
                    </div>
                    <!-- end row -->
                </div>
                <!-- ========== tables-wrapper end ========== -->
                </div>
                <!-- end container -->
            </section>
            <!-- ========== table components end ========== -->

            
        </main>
        <!-- ======== main-wrapper end =========== -->

        <!-- ========= All Javascript files linkup ======== -->
        <script src="../assets/js/bootstrap.bundle.min.js"></script>
        <script src="../assets/js/Chart.min.js"></script>
        <script src="../assets/js/dynamic-pie-chart.js"></script>
        <script src="../assets/js/moment.min.js"></script>
        <script src="../assets/js/fullcalendar.js"></script>
        <script src="../assets/js/jvectormap.min.js"></script>
        <script src="../assets/js/world-merc.js"></script>
        <script src="../assets/js/polyfill.js"></script>
        <script src="../assets/js/main.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script src="../index.js"></script>

        <script>
            let listKamar = [];
            const tBody = document.querySelector('tbody');
            window.onload = function() {
                const showToast = localStorage.getItem('showToast');
                if (showToast === 'true') {
                    let pesan = localStorage.getItem('message');
                    const myToast = new Toast(pesan).show();
                    localStorage.setItem('showToast', 'false');
                    localStorage.setItem('message', '');
                }
                getKamar();
            };
            

            async function getKamar() {
                await axios(
                    {
                        method: "get",
                        url: url + "kamar",
                        headers: {
                            Authorization : "Bearer " + localStorage.getItem("token")
                        }
                    },
                    document.body.classList.add("loading-indicator")
                )
                    .then((result) => {
                        document.body.classList.remove("loading-indicator");
                        listKamar = []
                        kamar = result.data.data;
                        kamar.forEach(element => {
                            listKamar.push(element);

                        });
                        listKamar.sort((a, b) => (parseInt(a.NomorKamar) > parseInt(b.NomorKamar)) ? 1 : -1)
                        const tableData = listKamar.map((item) => {
                            var status = item.Status == true ? '<span class="status-btn active-btn">Active</span>' : '<span class="status-btn close-btn">Close</span>';
                            return `
                                <tr>
                                    <td>${item.NomorKamar}</td>
                                    <td>${item.NamaTipe}</td>
                                    <td>${status}</td>
                                    <td>
                                        <div class="action">
                                            <button class="text-success" onclick="redirectToUpdatePage(${item.Id})">
                                                <i class="mdi mdi-update"></i>
                                            </button>
                                            <button class="text-danger" onclick="deleteKamar(${item.Id})">
                                                <i class="lni lni-trash-can"></i>
                                            </button>
                                        </div>    
                                    </td>
                                </tr>
                                `;
                        }).join("");
                        tBody.innerHTML = tableData;
                        console.log(listKamar);

                    })
                    .catch((err) => {
                        document.body.classList.remove("loading-indicator");
                        alert(err.response.data.message);
                        if(err.response.status == 403 ){
                            window.location.href = "../auth/signin.html";
                            localStorage.clear();
                        }
                        return Promise.reject(err);
                    });
            }

            async function getKamarByNomorKamar() {

                let nomorKamar = document.querySelector('input[type="text"]').value;

                if(nomorKamar == ""){
                    await getKamar();
                    return;
                }

                await axios(
                    {
                        method: "get",
                        url: url + "kamar/nomor/" + nomorKamar  ,
                        headers: {
                            Authorization : "Bearer " + localStorage.getItem("token")
                        }
                    },
                    document.body.classList.add("loading-indicator")
                )
                    .then((result) => {
                        document.body.classList.remove("loading-indicator");
                        console.log(result.data.data)
                        listKamar = []
                        kamar = result.data.data;
                        // kamar.forEach(element => {
                        //     listKamar.push(element);

                        // });
                        listKamar.push(kamar);

                        const tableData = listKamar.map((item) => {
                            console.log(item.id)
                            var status = item.Status == true ? '<span class="status-btn active-btn">Active</span>' : '<span class="status-btn close-btn">Close</span>';
                            return `
                                <tr>
                                    <td>${item.NomorKamar}</td>
                                    <td>${item.NamaTipe}</td>
                                    <td>${status}</td>
                                    <td>
                                        <div class="action">
                                            <button class="text-success" onclick="redirectToUpdatePage(${item.Id})">
                                                <i class="mdi mdi-update"></i>
                                            </button>
                                            <button class="text-danger" onclick="deleteKamar(${item.Id})">
                                                <i class="lni lni-trash-can"></i>
                                            </button>
                                        </div>    
                                    </td>
                                </tr>
                                `;
                        }).join("");
                        tBody.innerHTML = tableData;
                        console.log(listKamar);

                    })
                    .catch((err) => {
                        console.log(err);
                        document.body.classList.remove("loading-indicator");
                        if(err.response.status == 403 ){
                            window.location.href = "../auth/signin.html";
                            localStorage.clear();
                        }
                        if(err.response.status == 404 ){
                            const myToast = new Toast("Kamar tidak ditemukan").show();
                        }
                        return Promise.reject(err);
                    });
            }

            function redirectToUpdatePage(id) {
                params = new URLSearchParams()
                params.append("id", id);
                window.location.href = "kamar/update-kamar.html?" + params.toString();
            }

            async function deleteKamar(id) {

                const dialog = new ConfirmDialog({
                    trueButtonText: "Yes",
                    falseButtonText: "No",
                    questionText: "Apakah anda yakin ingin menghapus kamar ini?"
                });
                const shouldDelete = await dialog.confirm();

                if (!shouldDelete) {
                    const myToast = new Toast("Batal menghapus kamar").show();
                    return;
                }

                await axios(
                    {
                        method: "delete",
                        url:  url + "kamar/" + id,
                        headers: {
                            Authorization : "Bearer " + localStorage.getItem("token")
                        }

                    },
                    document.body.classList.add("loading-indicator")
                )
                    .then((result) => {
                        document.body.classList.remove("loading-indicator");
                        localStorage.setItem('showToast', 'true');
                        localStorage.setItem('message', "Berhasil hapus kamar");
                        window.location.reload();
                    })
                    .catch((err) => {
                        document.body.classList.remove("loading-indicator");
                        alert(err.response.data.message);
                        if(err.response.status == 403 ){
                            window.location.href = "../auth/signin.html";
                            localStorage.clear();
                        }
                        return Promise.reject(err);
                    });
            }

        </script>

    </body>

</html>